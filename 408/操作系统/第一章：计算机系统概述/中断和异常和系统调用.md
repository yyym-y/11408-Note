# 中断和异常和系统调用

* 中断和异常
	* 中断的作用：中断是操作系统内核重新夺回CPU使用权的方式
		* 中断会使CPU由用户态变为内核态
		* 没有中断技术无法实现多道程序并发，甚至没有操作系统
		* 操作系统必须拥有中断，甚至为此可以不存在系统调用
	* 中断的类型
		* **内中断（异常/例外/软中断）** 与当前执行的指令有关，信号来源于CPU内部（应用程序引起）
			* 非法事件/ CPU执行非法或参数非法的指令/应用程序执行陷入指令会主动引发内中断来请求服务
			* **陷入（trap）**：程序自己故意引发
			* **故障**：由错误条件引起的，可能·内核程序修复。内核程序修复故障后会把cpu使用权还给应用程序，比它继续执行
			* **终止**：由致命错误引起，内核程序无法修复该错误，因此一般不再将cpu使用权还给引终止的应用程序，而是直接终止
		* **外中断（中断/硬中断）** 与当前执行的指令无关，信号来源于CPU外部（操作系统发起）
			* **时钟中断**由时钟部件发出，实现多道程序并发运行
			* **I/O中断** 
	* 中断机制的基本原理
		* CPU根据中断信号类型查询中断向量表，找到对应的中断处理程序
		* 中断处理程序是内核程序，需要在内核态下运行
* 系统调用
	* 系统调用是操作系统内核向应用程序提供的服务接口
	* 系统调用比库函数更底层，直接与操作系统内核交互
	* 系统调用保证并发进程互斥访问共享资源，防止资源混杂
	* 系统调用的功能分类
		* 设备管理、文件控制、进程控制、进程通信、内存管理
	* 系统调用的基本过程
		* 用户程序将系统调用号和参数压入堆栈中
		* 调用实际的调用指令，接着执行一个陷入执行
		* 操作系统内核程序和硬件保护现场，将PC，PSW和通用寄存器信息压入堆栈中
		* 实际执行系统调用程序
		* 复原调用时信息
		* （断点信息一般由CPU在中断响应的时候自动保存在堆栈中，即硬件实现）