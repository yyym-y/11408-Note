# 内存映射文件

* 内存映射文件
    * 内存映射文件是操作系统向上层程序员提供的一个系统调用功能
    * 通过该功能，程序员可以更方便地访问文件数据
    * 内存映射文件还可以让多个进程共享同一个文件的数据
* 内存映射文件的工作原理
    * 使用mmap系统调用，操作系统将文件映射到进程的虚拟地址空间
    * mmap系统调用返回一个指针，指向映射区域的起始地址
    * 程序员通过访问该指针加偏移量的方式来访问文件数据
    * 操作系统会自动将缺失的数据块读入内存
    * 操作系统并没有直接把数据读入内存，如果你访问这个数据， 就会发生缺页异常，从而读入内容
* 内存映射文件的共享特性
    * 通过内存映射文件，多个进程可以共享同一个文件的数据
    * 操作系统通过修改页表，使不同进程的虚拟地址空间映射到相同的物理内存
    * 当一个进程修改了文件数据后，另一个进程立即可以看到数据的变化
    * 一些注意点
        * 对映射的文件发生缺页异常的时候，是将内容读入到缓存中，而这个缓存是不同进程共有的，所以如果一个进程触发缺页异常将对应的映射内容读入缓存， 那么只要这个页面不被置换掉， 那么其他进程就不会触发缺页异常了， 而是同步对这个缓存的内容进行修改
* 内存映射文件的优缺点
    * 优点：简化文件数据访问，实现文件数据共享，由操作系统优化磁盘IO
    * 缺点：可能增加内存占用，不适合访问随机位置的数据块