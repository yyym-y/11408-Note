# 多处理机调度

* 多处理机调度
  * 多处理机调度需要追求负载均衡和处理机亲和性两个目标
    * **负载均衡**：让所有CPU都同等忙碌，避免某些CPU过载
    * **处理机亲和性**：让进程尽量调度到同一个CPU上运行，利用CPU缓存提高运行速度
  * **公共就绪队列**
    * 将所有就绪进程放在一个统一的就绪队列中
    * 每个CPU空闲时运行调度程序，从公共就绪队列中选择一个进程运行
    * 需要确保CPU对公共就绪队列的访问是互斥的
    * 优点：天然实现负载均衡；缺点：处理机亲和性不好，进程可能会频繁切换CPU
    * 提高亲和度
      * 软亲和（调度程序尽量保证亲和性）
      * 硬亲和（用户进程通过系统调用要求固定CPU）
  * **私有就绪队列**
    * 每个CPU有自己的就绪队列
    * CPU空闲时从自己的私有队列中调度一个进程运行
    * 提高负载均衡的方法
      * **推迁移**
        * 操作系统会一直运行一个进程, 这个进程会检查每个核的负载,如果出现不平衡, 就需要将负载高的核的队列中推出一些进程到负载低的核的就绪队列中
      * **拉迁移**
        * CPU在调度的适合,会监测自己的负载以及其他核的负载,如果出现不平衡就会从其他核的就绪队列中拉取进程到自己的私有队列中
    * 私有就绪队列天然实现处理机亲和性，也可以通过硬亲和方式确保亲和性
