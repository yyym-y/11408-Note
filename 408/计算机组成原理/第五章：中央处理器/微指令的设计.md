# 一、微指令的设计

## 1. 微指令格式 (00:32)

**工作原理**：微程序控制器通过微指令发出控制信号，每条微指令可包含多个并行执行的微命令，每个微命令对应一根控制输出线。

**设计要点**：需要重点考虑微指令格式设计，包括如何表示控制信号和确定下一条微指令地址。

### 1) 微指令的编码方式 (06:24)

#### 直接编码方式 (06:49)

* **原理**：**操作控制字段**的每一位直接对应一个微操作命令，1表示有效。
* **优点**：简单直观、执行速度快、**并行性好**。
* **缺点**：**微指令字长过长**，n个微命令需要n位，导致**控存容量极大**（如Intel CPU控存占芯片面积一半）。
* **示例**：若第一位对应PC→MAR操作，最后一位对应主存读信号，则设置这两位为1即可并行执行这两个操作。

#### 字段直接编码方式 (09:56)

* **原理**：将控制字段分为若干段，每段经译码后发出控制信号。
* **分段原则**：
    * **互斥性微命令**分在同一段（如PC→MAR和PC+1互斥）。
    * **相容性微命令**分在不同段（如PC→MAR和1→R可并行）。
    * 每段需留出一个状态表示不操作（如3位字段用000表示不操作，最多表示7个互斥微命令）。
* **优点**：显著缩短微指令字长。
* **缺点**：需经过译码电路，速度较直接编码慢。
* **例题:微指令控制字段计算** (14:32)
    * **题目解析**：5个互斥类分别需要：**$\lceil\log_2(7+1)\rceil = 3$ 位**、**$\lceil\log_2(3+1)\rceil = 2$ 位**、**$\lceil\log_2(15+1)\rceil = 4$ 位**、**$\lceil\log_2(7+1)\rceil = 3$ 位**、**$\lceil\log_2(7+1)\rceil = 3$ 位**。
    * 总位数 = 3+2+4+3+3 = **15位**。
    * **对比**：直接编码需要33位，字段编码显著缩短字长。

#### 字段间接编码方式 (17:18)

* **原理**：字段的微命令需由其他字段解释，经过两级译码。
* **优点**：可进一步缩短字长。
* **缺点**：译码更复杂，并行性降低，速度更慢。

### 2. 微指令的地址形成方式 (18:51)

**主要方法**：

* **断定方式**：直接由下地址字段指出（最常考）。
* **操作码形成**：根据机器指令操作码经微地址形成部件产生。
* **增量计数法**：(CMAR)+1→CMAR（最常考）。
* **分支转移**：类似jump指令，指明转移条件和地址。
* **测试网络**：通过顺序逻辑结合标志信息决定。
* **硬件产生**：如取指周期固定从0地址开始。

### 1) 例题:下地址字段计算 (22:47)

* **题目解析**：总微指令数 = 公共取指微程序(2条) + 32条指令 × 平均4条 = **130条**。
* 要覆盖130条微指令，需要 $2^n \ge 130$，所以 $n = \lceil\log_2(130)\rceil = 8$。
* 故至少需要**8位**下地址字段。
* **答案**：8位。

---

# 二、知识回顾 (24:54)

## 1. 微指令类型

* **水平型微指令**: 每条微指令能定义多个可并行的微命令，执行效率高。
* **垂直型微指令**: 每条微指令只能定义一个微命令，由微操作码指明，结构简单但效率较低。
* **混合型微指令**: 在垂直型基础上增加简单并行操作，兼顾灵活性和效率。

## 2. 水平型微指令编码方式

* **直接编码(直接控制)**: 每个bit对应一个微命令，执行速度最快。
* **字段直接编码**: 互斥性微命令分在同一段，相容性分在不同段；每个段留出"不操作"状态；需译码电路处理，执行速度较慢。
* **字段间接编码**: 可能需要多级译码电路，执行速度最慢；一个字段的微命令需用另一个字段解释。

## 3. 下一条微指令地址形成方式

* **断定法(下地址法)**: 根据当前微指令下地址直接跳转。
* **计数器法**: 通过顺序执行。
* **操作码确定法**: 根据指令操作码确定执行周期。
* **硬件指定法**: 由专门硬件指明取指/中断周期的首地址。

## 4. 考点提示

* **编码方式重点**: **直接编码**和**字段直接编码**最常考。
* **地址形成方式重点**: **断定法**和**计数器法**最常考。
* **微程序首地址**: 由硬件直接指明或通过操作码确定。

---

# 三、知识小结

| 知识点          | 核心内容                                     | 考试重点/易混淆点                          | 难度系数 |
| :-------------- | :------------------------------------------- | :----------------------------------------- | :------- |
| 微指令控制器概述 | 微程序控制器工作原理和整体流程               | 微命令与微操作的一一对应关系               | ⭐⭐       |
| 微指令格式分类  | 水平型、垂直型、混合型三种格式特点对比       | 水平型(并行)vs垂直型(串行)的执行效率差异   | ⭐⭐⭐     |
| 相容性与互斥性  | 可并行执行的微命令称为相容性，不可并行的称为互斥性 | 如何判断微命令的相容/互斥关系            | ⭐⭐⭐⭐   |
| 水平型微指令    | 操作控制字段+顺序控制字段结构，支持多微操作并行 | 字段长度与控存容量的正比关系               | ⭐⭐⭐     |
| 垂直型微指令    | 每条仅定义1个微命令，由微操作码指定具体操作    | 256种操作用8位编码的数学原理               | ⭐⭐       |
| 混合型微指令    | 垂直型基础上增加有限并行操作                 | 设计折中方案的优势分析                     | ⭐⭐⭐     |
| 直接编码方式    | 每个比特对应特定微操作，控制信号直接输出     | 33个微命令需要33位字段的缺陷               | ⭐⭐⭐⭐   |
| 字段直接编码    | 互斥微命令分组，字段译码输出控制信号         | 15位编码实现33个微命令的压缩原理           | ⭐⭐⭐⭐⭐ |
| 字段间接编码    | 二级译码结构进一步缩短字长                   | 译码延迟导致的性能下降问题                 | ⭐⭐⭐     |
| 下地址确定方式  | 断定法/操作码映射/增量计数/分支转移/测试网络/硬件产生 | 断定法与增量计数法的典型应用场景           | ⭐⭐⭐⭐   |
| 微程序容量计算  | 取指周期2条+32指令×4条=130条的总量推算       | 8位地址字段覆盖128-256条的设计依据         | ⭐⭐⭐⭐   |